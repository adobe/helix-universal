/*
 * Copyright 2021 Adobe. All rights reserved.
 * This file is licensed to you under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License. You may obtain a copy
 * of the License at http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS
 * OF ANY KIND, either express or implied. See the License for the specific language
 * governing permissions and limitations under the License.
 */

/*
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
*/
import Storage from './storage-api.js';

let AWS;

export class AWSStorage extends Storage {
  static async presignURL(bucket, path, blobParams = {}, method = 'GET', expires = 60) {
    if (!AWS) {
      // eslint-disable-next-line import/no-extraneous-dependencies
      AWS = (await import('aws-sdk')).default;

      AWS.config.update({
        region: process.env.AWS_REGION || 'us-east-1',
        logger: console,
      });
    }

    const s3 = new AWS.S3();

    const operation = method === 'PUT' ? 'putObject' : 'getObject';
    const params = {
      Bucket: bucket,
      Key: path.startsWith('/') ? path.substring(1) : path,
      Expires: expires,
      ...blobParams,
    };

    return s3.getSignedUrl(operation, params);
  }
}
